---
lab:
  title: 使用 VS Code 扩展开发 AI 智能体
  description: 使用 Microsoft Foundry VS Code 扩展创建 AI 智能体。
---

# 使用 VS Code 扩展开发 AI 智能体

在本练习中，你将使用 Microsoft Foundry VS Code 扩展创建一个智能体，该智能体可以使用模型上下文协议 (MCP) 服务器工具访问外部数据源和 API。 该智能体将能够检索最新信息，并通过 MCP 工具与各种服务交互。

完成此练习大约需要 30 分钟。

> **注意**：本练习中使用的一些技术处于预览版或积极开发阶段。 可能会遇到一些意想不到的行为、警告或错误。

## 先决条件

在开始本练习之前，请确保满足以下条件：
- 已安装 Visual Studio Code
- 有效的 Azure 订阅

## 安装 Microsoft Foundry VS Code 扩展

首先，安装并设置 VS Code 扩展。

1. 打开 Visual Studio Code。

1. 从左窗格中选择“扩展”（或按 Ctrl+Shift+X）。********

1. 在搜索栏中，键入“Microsoft Foundry”，然后按 Enter。****

1. 从 Microsoft 选择“Microsoft Foundry”扩展，然后单击“安装”。********

1. 安装完成后，验证该扩展是否显示在 Visual Studio Code 左侧的主导航栏中。

## 登录到 Azure 并创建项目

现在，你将连接到 Azure 资源，创建一个新的 AI Foundry 项目。

1. 在 VS Code 边栏中，选择“Microsoft Foundry”扩展图标。****

1. 在“资源”视图中，选择“登录到 Azure...”，然后按照身份验证提示操作。****

   > **注意**：如果你已经登录，则不会看到此选项。

1. 在 Foundry 扩展视图中，选择“资源”旁边的 +（加号）图标，创建一个新的 Foundry 项目。********

1. 从下拉列表中选择自己的 Azure 订阅。

1. 选择是创建新的资源组还是使用现有资源组：
   
   若要创建新的资源组，请执行以下操作：****
   - 选择“创建新资源组”****，然后按 Enter
   - 输入资源组的名称（例如“rg-ai-agents-lab”），然后按 Enter
   - 从提供的选项中选择一个位置，然后按 Enter
   
   若要使用现有资源组，请执行以下操作：****
   - 从列表中选择要使用的资源组，然后按 Enter

1. 在文本框中输入 Foundry 项目的名称（例如“ai-agents-project”），然后按 Enter 键。

1. 等待项目部署完成。 随即出现一个弹出窗口，显示消息“已成功部署项目”。

## 部署模型

需要一个已部署的模型来与智能体一起使用。

1. 当出现“已成功部署项目”弹出窗口时，选择“部署模型”按钮。**** 此时将打开“模型目录”。

   > **提示**：此外，还可以通过在“资源”部分中选择“模型”旁边的 + 图标，或按 F1 并运行命令“Microsoft Foundry:**************** 打开模型目录”来访问“模型目录”。

1. 在“模型目录”中，找到 gpt-4 模型（可以使用搜索栏快速查找）。****

    ![Foundry VS Code 扩展中“模型目录”的屏幕截图。](Media/vs-code-model.png)

1. 选择 gpt-4 模型旁边的“部署”。****

1. 配置部署设置：
   - 部署名称****：输入名称，例如“gpt-4-deployment”
   - **部署类型**：选择“全局标准”（如果“全局标准”不可用，则选择“标准”）********
   - **模型版本**：保留默认设置
   - 每分钟词元数：**** 保留默认设置

1. 选择左下角的“在 Microsoft Foundry 中部署”。****

1. 在确认对话框中，选择“部署”以部署模型。****

1. 等待部署完成。 部署的模型将显示在“资源”视图中的“模型”部分下。****

## 使用设计器视图创建 AI 智能体

接下来，你将使用可视化设计器界面创建一个 AI 智能体。 你无需编写代码，而是通过用户界面配置智能体的指令、设置和工具。

1. 在 Microsoft Foundry 扩展视图中，找到“资源”部分。****

1. 选择“声明性智能体”子部分旁边的 +（加号）图标，创建新的 AI 智能体。********

    ![在 Microsoft Foundry VS Code 扩展中创建智能体的屏幕截图。](Media/vs-code-new-agent.png)

1. 出现提示时，选择用于保存智能体文件的位置。

1. “新建智能体”选项卡将打开“智能体首选项”编辑器以及 ****`.yaml` 配置文件。

### 在设计器中配置智能体

1. 在智能体首选项中，配置以下字段：
   - **名称**：输入智能体的描述性名称（例如“data-research-agent”）
   - 模型****：从下拉列表中选择 GPT-4o 部署
   - 说明****：输入系统说明，例如：
     ```
     You are an AI agent that helps users research information from various sources. Use the available tools to access up-to-date information and provide comprehensive responses based on external data sources.
     ```

1. 从 VS Code 菜单栏中选择“文件”>“保存”，保存配置。****

## 向智能体添加 MCP 服务器工具

接下来，你将添加一个模型上下文协议 (MCP) 服务器工具，使智能体能够访问外部 API 和数据源。

1. 在设计器的“工具”部分中，选择右上角的“添加工具”按钮。********

![在 Foundry VS Code 扩展中向智能体添加工具的屏幕截图。](Media/vs-code-agent-tools.png)

1. 从下拉菜单中选择“MCP 服务器”。****

1. 使用以下信息配置 MCP 服务器工具：
   - **服务器 URL**：输入 MCP 服务器的 URL（例如 `https://gitmcp.io/Azure/azure-rest-api-specs`）
   - 服务器标签：**** 输入唯一标识符（例如“github_docs_server”）

1. 将“允许的工具”下拉列表留空，以允许 MCP 服务器中的所有工具。****

1. 选择“创建工具”按钮，向智能体添加工具。****

## 将智能体部署到 Microsoft Foundry

1. 在智能体设计器视图中，选择左下角的“在 Microsoft Foundry 上创建智能体”按钮。****

1. 等待部署完成。

1. 在 VS Code 导航栏中，刷新“资源”视图。**** 已部署的智能体现在应显示在“声明性智能体”子部分下。****

## 在操场中测试智能体

1. 右键单击“声明性智能体”子部分中已部署的智能体。****

1. 从上下文菜单中选择“打开操场”。****

1. 智能体操场将在 VS Code 中的新选项卡中打开。

1. 键入测试提示，例如：

   ```output
   Can you help me find documentation about Azure Container Apps and provide an example of how to create one?
   ```

1. 发送消息，并观察 MCP 服务器工具的身份验证和审批提示：
    - 在本练习中，当系统提示时，选择“无身份验证”。****
    - 对于 MCP 工具审批首选项，可以选择“始终批准”。****

1. 查看智能体的响应，并注意它如何使用 MCP 服务器工具检索外部信息。

1. 检查“智能体批注”部分以查看智能体使用的信息源。****

## 为智能体生成示例代码

1. 右键单击已部署的智能体，并选择“打开代码文件”，或在“智能体首选项”页中选择“打开代码文件”按钮。********

1. 从下拉列表中选择首选的 SDK（Python、.NET、JavaScript 或 Java）。

1. 选择首选的编程语言。

1. 选择你偏好的身份验证方法。

1. 查看已生成的示例代码，该代码演示了如何以编程方式与智能体交互。

可以将此代码用作构建利用 AI 智能体的应用程序的起点。

## 查看对话历史记录和会话

1. 在“Azure 资源”视图中，展开“会话”子部分，可以查看在智能体交互期间创建的对话。********

1. 选择一个会话可查看“会话详细信息”页，其中显示：****
   - 对话中的各条消息
   - 运行信息和执行详细信息
   - 智能体响应和工具使用情况

1. 选择“查看运行信息”可查看有关每次运行的详细 JSON 信息。****

## 总结

在本练习中，你已使用 Foundry VS Code 扩展，通过 MCP 服务器工具创建了一个 AI 智能体。 智能体可以通过模型上下文协议访问外部数据源和 API，从而能够提供最新信息并与各项服务交互。 你还了解了如何在操场中测试智能体，并生成用于编程交互的示例代码。

## 清理

在完成对 Foundry VS Code 扩展的探索后，应清理资源，避免产生不必要的 Azure 成本。

### 删除智能体

1. 在 Foundry 门户中，从导航菜单中选择“智能体”。****

1. 选择你的智能体，然后选择“删除”按钮。****

### 删除模型

1. 在 VS Code 中，刷新“Azure 资源”视图。****

1. 展开“模型”子部分。****

1. 右键单击已部署的模型，然后选择“删除”。****

### 删除其他资源

1. 打开 [Azure 门户](https://portal.azure.com)。

1. 导航到包含 AI Foundry 资源的资源组。

1. 选择“删除资源组”并确认删除。****